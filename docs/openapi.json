{
  "openapi": "3.0.0",
  "info": {
    "title": "API de Livros",
    "version": "1.0.0",
    "description": "API RESTful para consulta de dados de livros extraídos do site Books to Scrape.\n\nEsta API fornece endpoints para:\n- Listar e buscar livros\n- Consultar categorias disponíveis\n- Obter estatísticas gerais e por categoria\n- Verificar o estado de saúde do serviço\n",
    "contact": {
      "name": "Gabriel Peixer",
      "email": "dj.conga@gmail.com"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "servers": [
    {
      "url": "https://api-livros-production-f911.up.railway.app",
      "description": "Servidor de produção (Railway)"
    },
    {
      "url": "http://localhost:5000",
      "description": "Servidor de desenvolvimento local"
    }
  ],
  "tags": [
    {
      "name": "Livros",
      "description": "Operações relacionadas a livros"
    },
    {
      "name": "Categorias",
      "description": "Categorias de livros"
    },
    {
      "name": "Estatísticas",
      "description": "Estatísticas sobre os livros"
    },
    {
      "name": "Machine Learning",
      "description": "Pipeline ML-Ready para modelos de Machine Learning"
    },
    {
      "name": "Saúde",
      "description": "Verificação de saúde da API"
    }
  ],
  "paths": {
    "/api/v1/books": {
      "get": {
        "tags": [
          "Livros"
        ],
        "summary": "Listar todos os livros",
        "description": "Retorna uma lista paginada de todos os livros disponíveis.",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Número da página (começa em 1)",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1,
              "minimum": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "description": "Quantidade de itens por página",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 20,
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de livros retornada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListaBooksResponse"
                },
                "example": {
                  "estado": "sucesso",
                  "dados": [
                    {
                      "id": 1,
                      "title": "A Light in the Attic",
                      "price": 51.77,
                      "availability": "In stock",
                      "rating": 3,
                      "category": "Poetry"
                    },
                    {
                      "id": 2,
                      "title": "Tipping the Velvet",
                      "price": 53.74,
                      "availability": "In stock",
                      "rating": 1,
                      "category": "Historical Fiction"
                    }
                  ],
                  "meta": {
                    "pagina": 1,
                    "por_pagina": 20,
                    "total_itens": 100,
                    "total_paginas": 5
                  }
                }
              }
            }
          },
          "400": {
            "description": "Parâmetros de paginação inválidos",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/books/{id}": {
      "get": {
        "tags": [
          "Livros"
        ],
        "summary": "Buscar livro por ID",
        "description": "Retorna os detalhes completos de um livro específico pelo ID.",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "ID do livro (1-indexed)",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1
            },
            "example": 1
          }
        ],
        "responses": {
          "200": {
            "description": "Livro encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BookResponse"
                },
                "example": {
                  "estado": "sucesso",
                  "dados": {
                    "id": 1,
                    "title": "A Light in the Attic",
                    "price": 51.77,
                    "availability": "In stock",
                    "rating": 3,
                    "category": "Poetry"
                  }
                }
              }
            }
          },
          "404": {
            "description": "Livro não encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "example": {
                  "estado": "erro",
                  "mensagem": "Livro não encontrado"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/books/search": {
      "get": {
        "tags": [
          "Livros"
        ],
        "summary": "Buscar livros por título e/ou categoria",
        "description": "Busca livros com filtros opcionais de título e categoria.",
        "parameters": [
          {
            "name": "title",
            "in": "query",
            "description": "Título ou parte do título do livro",
            "required": false,
            "schema": {
              "type": "string"
            },
            "example": "Light"
          },
          {
            "name": "category",
            "in": "query",
            "description": "Categoria ou parte da categoria",
            "required": false,
            "schema": {
              "type": "string"
            },
            "example": "Poetry"
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de livros encontrados",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                },
                "example": {
                  "estado": "sucesso",
                  "dados": [
                    {
                      "id": 1,
                      "title": "A Light in the Attic",
                      "price": 51.77,
                      "availability": "In stock",
                      "rating": 3,
                      "category": "Poetry"
                    }
                  ],
                  "meta": {
                    "total_resultados": 1
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/categories": {
      "get": {
        "tags": [
          "Categorias"
        ],
        "summary": "Listar todas as categorias",
        "description": "Retorna a lista de todas as categorias de livros disponíveis.",
        "responses": {
          "200": {
            "description": "Lista de categorias",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CategoriasResponse"
                },
                "example": {
                  "estado": "sucesso",
                  "dados": [
                    "Travel",
                    "Mystery",
                    "Historical Fiction",
                    "Sequential Art",
                    "Classics"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/stats": {
      "get": {
        "tags": [
          "Estatísticas"
        ],
        "summary": "Estatísticas gerais",
        "description": "Retorna estatísticas gerais sobre todos os livros.",
        "responses": {
          "200": {
            "description": "Estatísticas calculadas com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatsResponse"
                },
                "example": {
                  "estado": "sucesso",
                  "dados": {
                    "total_livros": 100,
                    "preco_medio": 35.07,
                    "preco_minimo": 10.0,
                    "preco_maximo": 59.99
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/stats/overview": {
      "get": {
        "tags": [
          "Estatísticas"
        ],
        "summary": "Overview estatístico completo",
        "description": "Retorna estatísticas gerais da coleção incluindo total de livros, preço médio e distribuição de ratings.",
        "responses": {
          "200": {
            "description": "Overview estatístico",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatsOverviewResponse"
                },
                "example": {
                  "estado": "sucesso",
                  "dados": {
                    "total_livros": 100,
                    "preco_medio": 35.07,
                    "preco_minimo": 10.0,
                    "preco_maximo": 59.99,
                    "distribuicao_ratings": {
                      "1_estrela": 15,
                      "2_estrelas": 20,
                      "3_estrelas": 30,
                      "4_estrelas": 25,
                      "5_estrelas": 10
                    },
                    "total_categorias": 50
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/stats/category/{category}": {
      "get": {
        "tags": [
          "Estatísticas"
        ],
        "summary": "Estatísticas por categoria",
        "description": "Retorna estatísticas dos livros de uma categoria específica.",
        "parameters": [
          {
            "name": "category",
            "in": "path",
            "description": "Nome da categoria",
            "required": true,
            "schema": {
              "type": "string"
            },
            "example": "Travel"
          }
        ],
        "responses": {
          "200": {
            "description": "Estatísticas da categoria",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatsCategoriaResponse"
                },
                "example": {
                  "estado": "sucesso",
                  "dados": {
                    "total_livros": 11,
                    "preco_medio": 42.5,
                    "preco_minimo": 15.0,
                    "preco_maximo": 55.0,
                    "categoria": "Travel"
                  }
                }
              }
            }
          },
          "404": {
            "description": "Categoria não encontrada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/health": {
      "get": {
        "tags": [
          "Saúde"
        ],
        "summary": "Verificar saúde da API",
        "description": "Verifica status da API e conectividade com os dados.",
        "responses": {
          "200": {
            "description": "API operacional",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                },
                "example": {
                  "estado": "sucesso",
                  "dados": {
                    "servico": "api-livros",
                    "versao": "v1",
                    "estado": "operacional",
                    "dados": {
                      "arquivo_existe": true,
                      "status": "ok",
                      "total_registros": 100
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/ping": {
      "get": {
        "tags": [
          "Saúde"
        ],
        "summary": "Teste de conectividade",
        "description": "Endpoint simples para testar conectividade com a API.",
        "responses": {
          "200": {
            "description": "Conexão OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PingResponse"
                },
                "example": {
                  "estado": "sucesso",
                  "dados": "pong"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/ml/features": {
      "get": {
        "tags": [
          "Machine Learning"
        ],
        "summary": "Features para ML",
        "description": "Retorna dados dos livros formatados como features para modelos ML.",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "description": "Número máximo de registros",
            "required": false,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Pular N primeiros registros",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Features extraídas",
            "content": {
              "application/json": {
                "example": {
                  "estado": "sucesso",
                  "dados": {
                    "total": 100,
                    "retornados": 2,
                    "features": [
                      {
                        "id": 1,
                        "titulo": "A Light in the Attic",
                        "categoria": "Poetry",
                        "preco": 51.77,
                        "rating": 3,
                        "em_estoque": true
                      }
                    ]
                  }
                }
              }
            }
          },
          "404": {
            "description": "Nenhum livro encontrado"
          }
        }
      }
    },
    "/api/v1/ml/training-data": {
      "get": {
        "tags": [
          "Machine Learning"
        ],
        "summary": "Dataset para treinamento",
        "description": "Retorna dados para treinar modelo de ML.",
        "parameters": [
          {
            "name": "target",
            "in": "query",
            "description": "Campo alvo (rating ou price)",
            "required": false,
            "schema": {
              "type": "string",
              "default": "rating"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Dataset de treinamento",
            "content": {
              "application/json": {
                "example": {
                  "estado": "sucesso",
                  "dados": {
                    "features": [
                      [
                        51.77,
                        3
                      ],
                      [
                        53.74,
                        1
                      ]
                    ],
                    "labels": [
                      3,
                      1
                    ],
                    "num_amostras": 100,
                    "colunas": [
                      "preco",
                      "rating"
                    ]
                  }
                }
              }
            }
          },
          "404": {
            "description": "Nenhum livro encontrado"
          }
        }
      }
    },
    "/api/v1/ml/predictions": {
      "post": {
        "tags": [
          "Machine Learning"
        ],
        "summary": "Receber predições",
        "description": "Recebe predições de um modelo externo.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "example": {
                "model_name": "meu_modelo",
                "predictions": [
                  {
                    "book_id": 1,
                    "rating": 4
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Predições recebidas",
            "content": {
              "application/json": {
                "example": {
                  "estado": "sucesso",
                  "dados": {
                    "mensagem": "Predições recebidas",
                    "modelo": "meu_modelo",
                    "quantidade": 1
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Book": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID do livro",
            "example": 1
          },
          "title": {
            "type": "string",
            "description": "Título do livro",
            "example": "A Light in the Attic"
          },
          "price": {
            "type": "number",
            "format": "float",
            "description": "Preço do livro em libras (£)",
            "example": 51.77
          },
          "availability": {
            "type": "string",
            "description": "Disponibilidade do livro",
            "example": "In stock"
          },
          "rating": {
            "type": "integer",
            "minimum": 0,
            "maximum": 5,
            "description": "Avaliação do livro (0-5 estrelas)",
            "example": 3
          },
          "category": {
            "type": "string",
            "description": "Categoria do livro",
            "example": "Poetry"
          }
        }
      },
      "ListaBooksResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string",
            "enum": [
              "sucesso"
            ]
          },
          "dados": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Book"
            }
          },
          "meta": {
            "type": "object",
            "properties": {
              "pagina": {
                "type": "integer"
              },
              "por_pagina": {
                "type": "integer"
              },
              "total_itens": {
                "type": "integer"
              },
              "total_paginas": {
                "type": "integer"
              }
            }
          }
        }
      },
      "BookResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string",
            "enum": [
              "sucesso"
            ]
          },
          "dados": {
            "$ref": "#/components/schemas/Book"
          }
        }
      },
      "SearchResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string",
            "enum": [
              "sucesso"
            ]
          },
          "dados": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Book"
            }
          },
          "meta": {
            "type": "object",
            "properties": {
              "total_resultados": {
                "type": "integer"
              }
            }
          }
        }
      },
      "CategoriasResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string",
            "enum": [
              "sucesso"
            ]
          },
          "dados": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "StatsResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string",
            "enum": [
              "sucesso"
            ]
          },
          "dados": {
            "type": "object",
            "properties": {
              "total_livros": {
                "type": "integer"
              },
              "preco_medio": {
                "type": "number",
                "format": "float"
              },
              "preco_minimo": {
                "type": "number",
                "format": "float"
              },
              "preco_maximo": {
                "type": "number",
                "format": "float"
              }
            }
          }
        }
      },
      "StatsOverviewResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string",
            "enum": [
              "sucesso"
            ]
          },
          "dados": {
            "type": "object",
            "properties": {
              "total_livros": {
                "type": "integer"
              },
              "preco_medio": {
                "type": "number",
                "format": "float"
              },
              "preco_minimo": {
                "type": "number",
                "format": "float"
              },
              "preco_maximo": {
                "type": "number",
                "format": "float"
              },
              "distribuicao_ratings": {
                "type": "object",
                "properties": {
                  "1_estrela": {
                    "type": "integer"
                  },
                  "2_estrelas": {
                    "type": "integer"
                  },
                  "3_estrelas": {
                    "type": "integer"
                  },
                  "4_estrelas": {
                    "type": "integer"
                  },
                  "5_estrelas": {
                    "type": "integer"
                  }
                }
              },
              "total_categorias": {
                "type": "integer"
              }
            }
          }
        }
      },
      "StatsCategoriaResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string",
            "enum": [
              "sucesso"
            ]
          },
          "dados": {
            "type": "object",
            "properties": {
              "total_livros": {
                "type": "integer"
              },
              "preco_medio": {
                "type": "number",
                "format": "float"
              },
              "preco_minimo": {
                "type": "number",
                "format": "float"
              },
              "preco_maximo": {
                "type": "number",
                "format": "float"
              },
              "categoria": {
                "type": "string"
              }
            }
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string",
            "enum": [
              "sucesso"
            ]
          },
          "dados": {
            "type": "object",
            "properties": {
              "servico": {
                "type": "string"
              },
              "versao": {
                "type": "string"
              },
              "estado": {
                "type": "string"
              },
              "dados": {
                "type": "object",
                "properties": {
                  "arquivo_existe": {
                    "type": "boolean"
                  },
                  "status": {
                    "type": "string"
                  },
                  "total_registros": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        }
      },
      "PingResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string",
            "enum": [
              "sucesso"
            ]
          },
          "dados": {
            "type": "string"
          }
        }
      },
      "ErroResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string",
            "enum": [
              "erro"
            ]
          },
          "mensagem": {
            "type": "string"
          }
        }
      },
      "MLFeature": {
        "type": "object",
        "description": "Feature de um livro para ML",
        "properties": {
          "id": {
            "type": "integer"
          },
          "titulo": {
            "type": "string"
          },
          "categoria": {
            "type": "string"
          },
          "preco": {
            "type": "number"
          },
          "rating": {
            "type": "integer"
          },
          "em_estoque": {
            "type": "boolean"
          }
        }
      },
      "MLFeaturesResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string"
          },
          "dados": {
            "type": "object",
            "properties": {
              "total": {
                "type": "integer"
              },
              "retornados": {
                "type": "integer"
              },
              "features": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/MLFeature"
                }
              }
            }
          }
        }
      },
      "MLTrainingDataResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string"
          },
          "dados": {
            "type": "object",
            "properties": {
              "features": {
                "type": "array",
                "items": {
                  "type": "array",
                  "items": {
                    "type": "number"
                  }
                }
              },
              "labels": {
                "type": "array",
                "items": {
                  "type": "number"
                }
              },
              "num_amostras": {
                "type": "integer"
              },
              "colunas": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "MLPredictionsRequest": {
        "type": "object",
        "required": [
          "model_name",
          "predictions"
        ],
        "properties": {
          "model_name": {
            "type": "string"
          },
          "predictions": {
            "type": "array",
            "items": {
              "type": "object"
            }
          }
        }
      },
      "MLPredictionsResponse": {
        "type": "object",
        "properties": {
          "estado": {
            "type": "string"
          },
          "dados": {
            "type": "object",
            "properties": {
              "mensagem": {
                "type": "string"
              },
              "modelo": {
                "type": "string"
              },
              "quantidade": {
                "type": "string"
              }
            }
          }
        }
      }
    }
  }
}